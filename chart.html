<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chart.js Example</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  </head>
  <body>
    <div style="width: 80%; margin: auto">
      <canvas id="myChart"></canvas>
    </div>

    <script>
      var dateStr = "2022 Nov";
      var formattedDate = moment(dateStr, "YYYY MMM");
      var parsedMonth = formattedDate.month(); // Get the month (0-indexed)

      console.log("parsedMonth:", parsedMonth);

      var data = [
        {
          year: "2006 Jan",
          percentage: 6.2,
          price: "424800.00",
        },
        {
          year: "2006 Feb",
          percentage: 6.5,
          price: "426000.00",
        },
        {
          year: "2006 Mar",
          percentage: 6.5,
          price: "426000.00",
        },
        {
          year: "2006 Apr",
          percentage: 7.3,
          price: "429200.00",
        },
        {
          year: "2006 May",
          percentage: 7.1,
          price: "428400.00",
        },
        {
          year: "2006 Jun",
          percentage: 7.3,
          price: "429200.00",
        },
        {
          year: "2006 Jul",
          percentage: 7.4,
          price: "429600.00",
        },
        {
          year: "2006 Aug",
          percentage: 7.9,
          price: "431600.00",
        },
        {
          year: "2006 Sep",
          percentage: 8.5,
          price: "434000.00",
        },
        {
          year: "2006 Oct",
          percentage: 9.4,
          price: "437600.00",
        },
        {
          year: "2006 Nov",
          percentage: 9.6,
          price: "438400.00",
        },
        {
          year: "2006 Dec",
          percentage: 10.4,
          price: "441600.00",
        },
        {
          year: "2007 Jan",
          percentage: 10.5,
          price: "442000.00",
        },
        {
          year: "2007 Feb",
          percentage: 10.6,
          price: "442400.00",
        },
        {
          year: "2007 Mar",
          percentage: 10.6,
          price: "442400.00",
        },
        {
          year: "2007 Apr",
          percentage: 10.4,
          price: "441600.00",
        },
        {
          year: "2007 May",
          percentage: 10.6,
          price: "442400.00",
        },
        {
          year: "2007 Jun",
          percentage: 10.8,
          price: "443200.00",
        },
        {
          year: "2007 Jul",
          percentage: 10.6,
          price: "442400.00",
        },
        {
          year: "2007 Aug",
          percentage: 10.3,
          price: "441200.00",
        },
        {
          year: "2007 Sep",
          percentage: 10,
          price: "440000.00",
        },
        {
          year: "2007 Oct",
          percentage: 9.1,
          price: "436400.00",
        },
        {
          year: "2007 Nov",
          percentage: 8.5,
          price: "434000.00",
        },
        {
          year: "2007 Dec",
          percentage: 7,
          price: "428000.00",
        },
        {
          year: "2008 Jan",
          percentage: 5.1,
          price: "420400.00",
        },
        {
          year: "2008 Feb",
          percentage: 3.9,
          price: "415600.00",
        },
        {
          year: "2008 Mar",
          percentage: 2.4,
          price: "409600.00",
        },
        {
          year: "2008 Apr",
          percentage: 0.5,
          price: "402000.00",
        },
        {
          year: "2008 May",
          percentage: 0,
          price: "400000.00",
        },
        {
          year: "2008 Jun",
          percentage: -2.4,
          price: "390400.00",
        },
        {
          year: "2008 Jul",
          percentage: -4.7,
          price: "381200.00",
        },
        {
          year: "2008 Aug",
          percentage: -7.2,
          price: "371200.00",
        },
        {
          year: "2008 Sep",
          percentage: -9.7,
          price: "361200.00",
        },
        {
          year: "2008 Oct",
          percentage: -11.3,
          price: "354800.00",
        },
        {
          year: "2008 Nov",
          percentage: -13.7,
          price: "345200.00",
        },
        {
          year: "2008 Dec",
          percentage: -14.9,
          price: "340400.00",
        },
        {
          year: "2009 Jan",
          percentage: -15.4,
          price: "338400.00",
        },
        {
          year: "2009 Feb",
          percentage: -15.6,
          price: "337600.00",
        },
        {
          year: "2009 Mar",
          percentage: -15.5,
          price: "338000.00",
        },
        {
          year: "2009 Apr",
          percentage: -14.9,
          price: "340400.00",
        },
        {
          year: "2009 May",
          percentage: -14.3,
          price: "342800.00",
        },
        {
          year: "2009 Jun",
          percentage: -12.2,
          price: "351200.00",
        },
        {
          year: "2009 Jul",
          percentage: -9.7,
          price: "361200.00",
        },
        {
          year: "2009 Aug",
          percentage: -6.9,
          price: "372400.00",
        },
        {
          year: "2009 Sep",
          percentage: -3.7,
          price: "385200.00",
        },
        {
          year: "2009 Oct",
          percentage: -1,
          price: "396000.00",
        },
        {
          year: "2009 Nov",
          percentage: 2.2,
          price: "408800.00",
        },
        {
          year: "2009 Dec",
          percentage: 4.4,
          price: "417600.00",
        },
        {
          year: "2010 Jan",
          percentage: 6.5,
          price: "426000.00",
        },
        {
          year: "2010 Feb",
          percentage: 8,
          price: "432000.00",
        },
        {
          year: "2010 Mar",
          percentage: 8.7,
          price: "434800.00",
        },
        {
          year: "2010 Apr",
          percentage: 9.1,
          price: "436400.00",
        },
        {
          year: "2010 May",
          percentage: 8.1,
          price: "432400.00",
        },
        {
          year: "2010 Jun",
          percentage: 7.6,
          price: "430400.00",
        },
        {
          year: "2010 Jul",
          percentage: 6.8,
          price: "427200.00",
        },
        {
          year: "2010 Aug",
          percentage: 5.7,
          price: "422800.00",
        },
        {
          year: "2010 Sep",
          percentage: 4.6,
          price: "418400.00",
        },
        {
          year: "2010 Oct",
          percentage: 2.8,
          price: "411200.00",
        },
        {
          year: "2010 Nov",
          percentage: 1.2,
          price: "404800.00",
        },
        {
          year: "2010 Dec",
          percentage: 0.4,
          price: "401600.00",
        },
        {
          year: "2011 Jan",
          percentage: -0.1,
          price: "399600.00",
        },
        {
          year: "2011 Feb",
          percentage: -0.9,
          price: "396400.00",
        },
        {
          year: "2011 Mar",
          percentage: -1.3,
          price: "394800.00",
        },
        {
          year: "2011 Apr",
          percentage: -1.1,
          price: "395600.00",
        },
        {
          year: "2011 May",
          percentage: -2,
          price: "392000.00",
        },
        {
          year: "2011 Jun",
          percentage: -2.3,
          price: "390800.00",
        },
        {
          year: "2011 Jul",
          percentage: -2.1,
          price: "391600.00",
        },
        {
          year: "2011 Aug",
          percentage: -2,
          price: "392000.00",
        },
        {
          year: "2011 Sep",
          percentage: -2,
          price: "392000.00",
        },
        {
          year: "2011 Oct",
          percentage: -2,
          price: "392000.00",
        },
        {
          year: "2011 Nov",
          percentage: -0.7,
          price: "397200.00",
        },
        {
          year: "2011 Dec",
          percentage: -1,
          price: "396000.00",
        },
        {
          year: "2012 Jan",
          percentage: -0.8,
          price: "396800.00",
        },
        {
          year: "2012 Feb",
          percentage: -0.6,
          price: "397600.00",
        },
        {
          year: "2012 Mar",
          percentage: 0.2,
          price: "400800.00",
        },
        {
          year: "2012 Apr",
          percentage: -0.2,
          price: "399200.00",
        },
        {
          year: "2012 May",
          percentage: 0.6,
          price: "402400.00",
        },
        {
          year: "2012 Jun",
          percentage: 1.4,
          price: "405600.00",
        },
        {
          year: "2012 Jul",
          percentage: 0.5,
          price: "402000.00",
        },
        {
          year: "2012 Aug",
          percentage: 0.5,
          price: "402000.00",
        },
        {
          year: "2012 Sep",
          percentage: 0.4,
          price: "401600.00",
        },
        {
          year: "2012 Oct",
          percentage: 0.8,
          price: "403200.00",
        },
        {
          year: "2012 Nov",
          percentage: 0.9,
          price: "403600.00",
        },
        {
          year: "2012 Dec",
          percentage: 1.1,
          price: "404400.00",
        },
        {
          year: "2013 Jan",
          percentage: 1.1,
          price: "404400.00",
        },
        {
          year: "2013 Feb",
          percentage: 1.3,
          price: "405200.00",
        },
        {
          year: "2013 Mar",
          percentage: 1.6,
          price: "406400.00",
        },
        {
          year: "2013 Apr",
          percentage: 1.5,
          price: "406000.00",
        },
        {
          year: "2013 May",
          percentage: 1.7,
          price: "406800.00",
        },
        {
          year: "2013 Jun",
          percentage: 1.5,
          price: "406000.00",
        },
        {
          year: "2013 Jul",
          percentage: 2.3,
          price: "409200.00",
        },
        {
          year: "2013 Aug",
          percentage: 3,
          price: "412000.00",
        },
        {
          year: "2013 Sep",
          percentage: 3.4,
          price: "413600.00",
        },
        {
          year: "2013 Oct",
          percentage: 3.7,
          price: "414800.00",
        },
        {
          year: "2013 Nov",
          percentage: 4.2,
          price: "416800.00",
        },
        {
          year: "2013 Dec",
          percentage: 5.4,
          price: "421600.00",
        },
        {
          year: "2014 Jan",
          percentage: 6.2,
          price: "424800.00",
        },
        {
          year: "2014 Feb",
          percentage: 6.7,
          price: "426800.00",
        },
        {
          year: "2014 Mar",
          percentage: 6.4,
          price: "425600.00",
        },
        {
          year: "2014 Apr",
          percentage: 7.7,
          price: "430800.00",
        },
        {
          year: "2014 May",
          percentage: 8.3,
          price: "433200.00",
        },
        {
          year: "2014 Jun",
          percentage: 8.4,
          price: "433600.00",
        },
        {
          year: "2014 Jul",
          percentage: 8.7,
          price: "434800.00",
        },
        {
          year: "2014 Aug",
          percentage: 9.1,
          price: "436400.00",
        },
        {
          year: "2014 Sep",
          percentage: 9.1,
          price: "436400.00",
        },
        {
          year: "2014 Oct",
          percentage: 9.4,
          price: "437600.00",
        },
        {
          year: "2014 Nov",
          percentage: 8.4,
          price: "433600.00",
        },
        {
          year: "2014 Dec",
          percentage: 7.7,
          price: "430800.00",
        },
        {
          year: "2015 Jan",
          percentage: 7,
          price: "428000.00",
        },
        {
          year: "2015 Feb",
          percentage: 6.7,
          price: "426800.00",
        },
        {
          year: "2015 Mar",
          percentage: 6.7,
          price: "426800.00",
        },
        {
          year: "2015 Apr",
          percentage: 5.3,
          price: "421200.00",
        },
        {
          year: "2015 May",
          percentage: 5.3,
          price: "421200.00",
        },
        {
          year: "2015 Jun",
          percentage: 5.2,
          price: "420800.00",
        },
        {
          year: "2015 Jul",
          percentage: 5.5,
          price: "422000.00",
        },
        {
          year: "2015 Aug",
          percentage: 5.2,
          price: "420800.00",
        },
        {
          year: "2015 Sep",
          percentage: 5.3,
          price: "421200.00",
        },
        {
          year: "2015 Oct",
          percentage: 5.6,
          price: "422400.00",
        },
        {
          year: "2015 Nov",
          percentage: 6.8,
          price: "427200.00",
        },
        {
          year: "2015 Dec",
          percentage: 6.9,
          price: "427600.00",
        },
        {
          year: "2016 Jan",
          percentage: 7.8,
          price: "431200.00",
        },
        {
          year: "2016 Feb",
          percentage: 7.7,
          price: "430800.00",
        },
        {
          year: "2016 Mar",
          percentage: 8.4,
          price: "433600.00",
        },
        {
          year: "2016 Apr",
          percentage: 7.9,
          price: "431600.00",
        },
        {
          year: "2016 May",
          percentage: 8,
          price: "432000.00",
        },
        {
          year: "2016 Jun",
          percentage: 8.2,
          price: "432800.00",
        },
        {
          year: "2016 Jul",
          percentage: 7.5,
          price: "430000.00",
        },
        {
          year: "2016 Aug",
          percentage: 6.5,
          price: "426000.00",
        },
        {
          year: "2016 Sep",
          percentage: 6.1,
          price: "424400.00",
        },
        {
          year: "2016 Oct",
          percentage: 5.6,
          price: "422400.00",
        },
        {
          year: "2016 Nov",
          percentage: 5.3,
          price: "421200.00",
        },
        {
          year: "2016 Dec",
          percentage: 5.2,
          price: "420800.00",
        },
        {
          year: "2017 Jan",
          percentage: 4.8,
          price: "419200.00",
        },
        {
          year: "2017 Feb",
          percentage: 4.9,
          price: "419600.00",
        },
        {
          year: "2017 Mar",
          percentage: 3.6,
          price: "414400.00",
        },
        {
          year: "2017 Apr",
          percentage: 4.9,
          price: "419600.00",
        },
        {
          year: "2017 May",
          percentage: 4.3,
          price: "417200.00",
        },
        {
          year: "2017 Jun",
          percentage: 4.2,
          price: "416800.00",
        },
        {
          year: "2017 Jul",
          percentage: 4.5,
          price: "418000.00",
        },
        {
          year: "2017 Aug",
          percentage: 4.9,
          price: "419600.00",
        },
        {
          year: "2017 Sep",
          percentage: 4.7,
          price: "418800.00",
        },
        {
          year: "2017 Oct",
          percentage: 5.1,
          price: "420400.00",
        },
        {
          year: "2017 Nov",
          percentage: 4.3,
          price: "417200.00",
        },
        {
          year: "2017 Dec",
          percentage: 4.6,
          price: "418400.00",
        },
        {
          year: "2018 Jan",
          percentage: 4.3,
          price: "417200.00",
        },
        {
          year: "2018 Feb",
          percentage: 4.4,
          price: "417600.00",
        },
        {
          year: "2018 Mar",
          percentage: 4,
          price: "416000.00",
        },
        {
          year: "2018 Apr",
          percentage: 3.3,
          price: "413200.00",
        },
        {
          year: "2018 May",
          percentage: 3.1,
          price: "412400.00",
        },
        {
          year: "2018 Jun",
          percentage: 2.9,
          price: "411600.00",
        },
        {
          year: "2018 Jul",
          percentage: 2.9,
          price: "411600.00",
        },
        {
          year: "2018 Aug",
          percentage: 2.7,
          price: "410800.00",
        },
        {
          year: "2018 Sep",
          percentage: 2.9,
          price: "411600.00",
        },
        {
          year: "2018 Oct",
          percentage: 2.7,
          price: "410800.00",
        },
        {
          year: "2018 Nov",
          percentage: 2.6,
          price: "410400.00",
        },
        {
          year: "2018 Dec",
          percentage: 2,
          price: "408000.00",
        },
        {
          year: "2019 Jan",
          percentage: 1.7,
          price: "406800.00",
        },
        {
          year: "2019 Feb",
          percentage: 1.2,
          price: "404800.00",
        },
        {
          year: "2019 Mar",
          percentage: 1.5,
          price: "406000.00",
        },
        {
          year: "2019 Apr",
          percentage: 1.3,
          price: "405200.00",
        },
        {
          year: "2019 May",
          percentage: 1,
          price: "404000.00",
        },
        {
          year: "2019 Jun",
          percentage: 0.7,
          price: "402800.00",
        },
        {
          year: "2019 Jul",
          percentage: 0.6,
          price: "402400.00",
        },
        {
          year: "2019 Aug",
          percentage: 0.6,
          price: "402400.00",
        },
        {
          year: "2019 Sep",
          percentage: 0.9,
          price: "403600.00",
        },
        {
          year: "2019 Oct",
          percentage: 0.7,
          price: "402800.00",
        },
        {
          year: "2019 Nov",
          percentage: 0.8,
          price: "403200.00",
        },
        {
          year: "2019 Dec",
          percentage: 0.9,
          price: "403600.00",
        },
        {
          year: "2020 Jan",
          percentage: 1.6,
          price: "406400.00",
        },
        {
          year: "2020 Feb",
          percentage: 1.3,
          price: "405200.00",
        },
        {
          year: "2020 Mar",
          percentage: 2.5,
          price: "410000.00",
        },
        {
          year: "2020 Apr",
          percentage: 0.7,
          price: "402800.00",
        },
        {
          year: "2020 May",
          percentage: 1.1,
          price: "404400.00",
        },
        {
          year: "2020 Jun",
          percentage: 2,
          price: "408000.00",
        },
        {
          year: "2020 Jul",
          percentage: 1.7,
          price: "406800.00",
        },
        {
          year: "2020 Aug",
          percentage: 2.4,
          price: "409600.00",
        },
        {
          year: "2020 Sep",
          percentage: 3.4,
          price: "413600.00",
        },
        {
          year: "2020 Oct",
          percentage: 4.6,
          price: "418400.00",
        },
        {
          year: "2020 Nov",
          percentage: 6,
          price: "424000.00",
        },
        {
          year: "2020 Dec",
          percentage: 7,
          price: "428000.00",
        },
        {
          year: "2021 Jan",
          percentage: 7.7,
          price: "430800.00",
        },
        {
          year: "2021 Feb",
          percentage: 8.3,
          price: "433200.00",
        },
        {
          year: "2021 Mar",
          percentage: 9,
          price: "436000.00",
        },
        {
          year: "2021 Apr",
          percentage: 9,
          price: "436000.00",
        },
        {
          year: "2021 May",
          percentage: 9,
          price: "436000.00",
        },
        {
          year: "2021 Jun",
          percentage: 13.6,
          price: "454400.00",
        },
        {
          year: "2021 Jul",
          percentage: 7.2,
          price: "428800.00",
        },
        {
          year: "2021 Aug",
          percentage: 9.6,
          price: "438400.00",
        },
        {
          year: "2021 Sep",
          percentage: 11.7,
          price: "446800.00",
        },
        {
          year: "2021 Oct",
          percentage: 9.1,
          price: "436400.00",
        },
        {
          year: "2021 Nov",
          percentage: 10.4,
          price: "441600.00",
        },
        {
          year: "2021 Dec",
          percentage: 10,
          price: "440000.00",
        },
        {
          year: "2022 Jan",
          percentage: 9.6,
          price: "438400.00",
        },
      ];

      console.log("data ===== ", data);
      var date = ["1998-11-10", "2000-09-28", "2019-10-04"];
      console.log('date ===== ',date);
      var price = ["12000", "12000", "90000"];
      console.log('price ===== ',price);

      var dynamicDate = moment(date.slice(-1)[0]);
      console.log('dynamicDate ===== ',dynamicDate);
      var selectedYear = dynamicDate.year();
      console.log('selectedYear ===== ',selectedYear);
      var selectedMonth = dynamicDate.month();
      console.log('selectedMonth ===== ',selectedMonth);

      console.log(' ------------------------------------------------------------------------------------------------------------------------------ ');
      var filteredData = data.filter((entry) => {
        console.warn(' ------------------ ');
        console.log('entry ===== ',entry);
        var entryYear = parseInt(entry.year.split(" ")[0]);
        console.log('entryYear ===== ',entryYear);
        var entryMonth = moment(entry.year, "YYYY MMM").month();
        console.log('entryMonth ===== ',entryMonth);
        console.log('entryYear >= selectedYear && entryMonth === selectedMonth ===== ',entryYear >= selectedYear && entryMonth === selectedMonth);
        return entryYear >= selectedYear && entryMonth === selectedMonth;
      });
      console.log(' ------------------------------------------------------------------------------------------------------------------------------ ');

      var mergedData = [];

      for (var i = 0; i < date.length; i++) {
        var formattedDate = `${new Date(date[i]).getFullYear()} ${new Date(
          date[i]
        ).toLocaleString("default", { month: "short" })}`;
        mergedData.push({
          year: formattedDate,
          percentage: 0,
          price: parseFloat(price[i]).toFixed(2),
        });
      }

      console.log('mergedData ===== ',mergedData);

      var mergeLastPrice = mergedData.slice(-1)[0].price;
      console.log('mergeLastPrice ===== ',mergeLastPrice);
      var dynamicYearMonth = mergedData.slice(-1)[0].year;
      console.log('dynamicYearMonth ===== ',dynamicYearMonth);
      var dynamicDate = moment(`${mergedData.slice(-1)[0].year}`, "YYYY-MM");
      console.log('dynamicDate ===== ',dynamicDate);

      console.error("--============================================================================");
      var filteredData22 = filteredData.filter((item) => {
        console.warn('==================');
        console.log('item ===== ',item);
        var year = parseInt(item.year.split(" ")[0]);
        console.log('year ===== ',year);
        var month = item.year.split(" ")[1];
        console.log('month ===== ',month);
        var itemDate = moment(`${item.year}-01`, "YYYY-MM-DD");
        console.log('itemDate ===== ',itemDate);
        console.log('dynamicDate ===== ',dynamicDate.format("YYYY-MM-DD"));
        console.log('itemDate.isAfter(dynamicDate) ===== ',itemDate.isAfter(dynamicDate));
        return itemDate.isAfter(dynamicDate);
      });

      console.log('filteredData22 ===== ',filteredData22);

      var filteredData = mergedData.concat(filteredData22);

      console.warn('new Data --------  ===== ',filteredData);

      for (let i = mergedData.length; i < filteredData.length; i++) {
        var prevPrice = parseFloat(filteredData[i - 1].price);
        var prevPercentage = parseFloat(filteredData[i - 1].percentage);
        var currentPrice = parseFloat(filteredData[i].price);
        filteredData[i].price = (
          prevPrice +
          (prevPrice * prevPercentage) / 100
        ).toString();
      }

      var labels = filteredData.map((entry) => entry.year);
      var prices = filteredData.map((entry) => parseFloat(entry.price));

      var ctx = document.getElementById("myChart").getContext("2d");
      var myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Price",
              data: prices,
              borderColor: "rgba(75, 192, 192, 1)",
              borderWidth: 1,
              fill: false,
            },
          ],
        },
        options: {
          scales: {
            x: {
              ticks: {
                autoSkip: false,
                maxTicksLimit: 10,
                type: "datetime",
              },
            },
            y: {
              beginAtZero: false,
            },
          },
        },
        tooltip: {
    x: {
      show: false,
      format: "dd MMM yyyy HH:mm"
    },
  }
      });
    </script>
  </body>
</html>
